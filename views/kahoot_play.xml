<odoo>
  <template id="kahoot_play_page" name="Kahoot Play Page">
    <t t-call="website.layout">
      <div class="o_container">
        <section class="kahoot-wrapper">
          <h1>¡Bienvenido al juego!</h1>

          <t t-if="game">
            <p>Juego ID: <t t-esc="game.id"/></p>
            <p>Nombre del quiz: <t t-esc="game.survey_id.title"/></p>

            <t t-if="game.current_question_id">
              <div class="question">
                <h2><t t-esc="game.current_question_id.title"/></h2>
                <ul>
                  <t t-foreach="game.current_question_id.suggested_answer_ids" t-as="answer">
                    <li>
                      <button 
                        t-att-data-answer-id="answer.id"
                        t-att-data-question-id="game.current_question_id.id"
                        t-att-data-participant-id="participant_id"
                        onclick="submitAnswer(this)">
                        <t t-esc="answer.value"/>
                      </button>
                    </li>
                  </t>
                </ul>
              </div>
            </t>
            <t t-else="">
              <p>Esperando a que comience la primera pregunta...</p>
            </t>
          </t>
          <t t-else="">
            <p>Error: no se encontró el juego.</p>
          </t>
        </section>
      </div>

      <script>
        function submitAnswer(button) {
          const answerId = button.getAttribute('data-answer-id');
          const questionId = button.getAttribute('data-question-id');
          const participantId = button.getAttribute('data-participant-id');

          fetch('/kahoot/submit_answer', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              answer_id: parseInt(answerId),
              question_id: parseInt(questionId),
              participant_id: parseInt(participantId)
            })
          })
          .then(res => res.json())
          .then(data => {
            if (data.status === 'ok') {
              alert("✅ Respuesta registrada");
            } else {
              alert("❌ Error: " + data.message);
            }
          });
        }
      </script>
    </t>
  </template>
</odoo>


